<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Public API · EpiAware.jl</title><meta name="title" content="Public API · EpiAware.jl"/><meta property="og:title" content="Public API · EpiAware.jl"/><meta property="twitter:title" content="Public API · EpiAware.jl"/><meta name="description" content="Documentation for EpiAware.jl."/><meta property="og:description" content="Documentation for EpiAware.jl."/><meta property="twitter:description" content="Documentation for EpiAware.jl."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">EpiAware.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">EpiAware.jl: Real-time infectious disease monitoring</a></li><li><span class="tocitem">Getting started</span><ul><li><a class="tocitem" href="../../../getting-started/">Overview</a></li><li><a class="tocitem" href="../../../getting-started/installation/">Installation</a></li><li><a class="tocitem" href="../../../getting-started/quickstart/">Quickstart</a></li><li><a class="tocitem" href="../../../getting-started/faq/">Frequently asked questions</a></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Explainers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../getting-started/explainers/">Overview</a></li><li><a class="tocitem" href="../../../getting-started/explainers/julia/">Working with Julia</a></li><li><a class="tocitem" href="../../../getting-started/explainers/intro/">Introduction to EpiAware</a></li><li><a class="tocitem" href="../../../getting-started/explainers/modelling-infections/">Modelling infections</a></li><li><a class="tocitem" href="../../../getting-started/explainers/inference/">Inference</a></li><li><a class="tocitem" href="../../../getting-started/explainers/latent-models/">Latent models</a></li><li><a class="tocitem" href="../../../getting-started/explainers/observation-models/">Observation models</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-6" type="checkbox"/><label class="tocitem" for="menuitem-2-6"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../getting-started/tutorials/">Overview</a></li><li><a class="tocitem" href="../../../getting-started/tutorials/simple-renewal-with-delays/">Simple renewal with delays</a></li><li><a class="tocitem" href="../../../getting-started/tutorials/nowcasting/">Nowcasting</a></li><li><a class="tocitem" href="../../../getting-started/tutorials/multiple-observation-models/">Multiple observation models</a></li><li><a class="tocitem" href="../../../getting-started/tutorials/multiple-infection-processes/">Multiple infection processes</a></li><li><a class="tocitem" href="../../../getting-started/tutorials/censored-obs/">Fitting distributions with censored data</a></li><li><a class="tocitem" href="../../../getting-started/tutorials/partial-pooling/">Partial pooling</a></li></ul></li></ul></li><li><span class="tocitem">Showcase</span><ul><li><a class="tocitem" href="../../../showcase/">Overview</a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Replication</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../showcase/replications/mishra-2020/">On the derivation of the renewal equation from an age-dependent branching process: an epidemic modelling perspective</a></li><li><a class="tocitem" href="../../../showcase/replications/chatzilena-2019/">Statistical inference for ODE-based infectious disease models</a></li></ul></li></ul></li><li><span class="tocitem">What is EpiAware?</span><ul><li><a class="tocitem" href="../../../overview/">Overview</a></li></ul></li><li><span class="tocitem">Modules</span><ul><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">EpiAware</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../">Overview</a></li><li><a class="tocitem" href="../../public/">Public API</a></li><li><a class="tocitem" href="../../internals/">Internal API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">EpiAwareBase</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../EpiAwareBase/">Overview</a></li><li><a class="tocitem" href="../../EpiAwareBase/public/">Public API</a></li><li><a class="tocitem" href="../../EpiAwareBase/internals/">Internal API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">EpiAwareUtils</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../EpiAwareUtils/">Overview</a></li><li><a class="tocitem" href="../../EpiAwareUtils/public/">Public API</a></li><li><a class="tocitem" href="../../EpiAwareUtils/internals/">Internal API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-4" type="checkbox"/><label class="tocitem" for="menuitem-5-4"><span class="docs-label">EpiInference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../EpiInference/">Overview</a></li><li><a class="tocitem" href="../../EpiInference/public/">Public API</a></li><li><a class="tocitem" href="../../EpiInference/internals/">Internal API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-5" type="checkbox" checked/><label class="tocitem" for="menuitem-5-5"><span class="docs-label">EpiInfModels</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../">Overview</a></li><li class="is-active"><a class="tocitem" href>Public API</a><ul class="internal"><li><a class="tocitem" href="#Contents"><span>Contents</span></a></li><li><a class="tocitem" href="#Index"><span>Index</span></a></li><li><a class="tocitem" href="#Public-API"><span>Public API</span></a></li></ul></li><li><a class="tocitem" href="../internals/">Internal API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-6" type="checkbox"/><label class="tocitem" for="menuitem-5-6"><span class="docs-label">EpiLatentModels</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../EpiLatentModels/">Overview</a></li><li><a class="tocitem" href="../../EpiLatentModels/public/">Public API</a></li><li><a class="tocitem" href="../../EpiLatentModels/internals/">Internal API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-7" type="checkbox"/><label class="tocitem" for="menuitem-5-7"><span class="docs-label">EpiObsModels</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../EpiObsModels/">Overview</a></li><li><a class="tocitem" href="../../EpiObsModels/public/">Public API</a></li><li><a class="tocitem" href="../../EpiObsModels/internals/">Internal API</a></li></ul></li></ul></li><li><span class="tocitem">Developers</span><ul><li><a class="tocitem" href="../../../developer/">Overview</a></li><li><a class="tocitem" href="../../../developer/contributing/">Contributing</a></li><li><a class="tocitem" href="../../../developer/checklist/">Release checklist</a></li></ul></li><li><a class="tocitem" href="../../../release-notes/">Release notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Modules</a></li><li><a class="is-disabled">EpiInfModels</a></li><li class="is-active"><a href>Public API</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Public API</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CDCgov/Rt-without-renewal" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CDCgov/Rt-without-renewal/blob/main/docs/src/lib/EpiInfModels/public.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Public-Documentation"><a class="docs-heading-anchor" href="#Public-Documentation">Public Documentation</a><a id="Public-Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#Public-Documentation" title="Permalink"></a></h1><p>Documentation for <code>EpiInfModels.jl</code>&#39;s public interface.</p><p>See the Internals section of the manual for internal package docs covering all submodules.</p><h2 id="Contents"><a class="docs-heading-anchor" href="#Contents">Contents</a><a id="Contents-1"></a><a class="docs-heading-anchor-permalink" href="#Contents" title="Permalink"></a></h2><ul><li><a href="#Contents">Contents</a></li><li><a href="#Index">Index</a></li><li><a href="#Public-API">Public API</a></li></ul><h2 id="Index"><a class="docs-heading-anchor" href="#Index">Index</a><a id="Index-1"></a><a class="docs-heading-anchor-permalink" href="#Index" title="Permalink"></a></h2><ul><li><a href="#EpiAware.EpiInfModels"><code>EpiAware.EpiInfModels</code></a></li><li><a href="#EpiAware.EpiInfModels.DirectInfections"><code>EpiAware.EpiInfModels.DirectInfections</code></a></li><li><a href="#EpiAware.EpiInfModels.EpiData"><code>EpiAware.EpiInfModels.EpiData</code></a></li><li><a href="#EpiAware.EpiInfModels.ExpGrowthRate"><code>EpiAware.EpiInfModels.ExpGrowthRate</code></a></li><li><a href="#EpiAware.EpiInfModels.ODEProcess"><code>EpiAware.EpiInfModels.ODEProcess</code></a></li><li><a href="#EpiAware.EpiInfModels.Renewal"><code>EpiAware.EpiInfModels.Renewal</code></a></li><li><a href="#EpiAware.EpiInfModels.R_to_r-Union{Tuple{T}, Tuple{Any, Vector{T}}} where T&lt;:AbstractFloat"><code>EpiAware.EpiInfModels.R_to_r</code></a></li><li><a href="#EpiAware.EpiInfModels.expected_Rt-Tuple{EpiData, Vector{&lt;:Real}}"><code>EpiAware.EpiInfModels.expected_Rt</code></a></li><li><a href="#EpiAware.EpiInfModels.r_to_R-Tuple{Any, AbstractVector}"><code>EpiAware.EpiInfModels.r_to_R</code></a></li></ul><h2 id="Public-API"><a class="docs-heading-anchor" href="#Public-API">Public API</a><a id="Public-API-1"></a><a class="docs-heading-anchor-permalink" href="#Public-API" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EpiAware.EpiInfModels" href="#EpiAware.EpiInfModels"><code>EpiAware.EpiInfModels</code></a> — <span class="docstring-category">Module</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Module for defining epidemiological models.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CDCgov/Rt-without-renewal/blob/94b46434c009860480828faa6a06b5e7fc4bafa1/src/EpiInfModels/EpiInfModels.jl#L1-L3">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EpiAware.EpiInfModels.DirectInfections" href="#EpiAware.EpiInfModels.DirectInfections"><code>EpiAware.EpiInfModels.DirectInfections</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct DirectInfections{S&lt;:Distributions.Sampleable} &lt;: AbstractTuringEpiModel</code></pre><p>Model unobserved/latent infections as a transformation on a sampled latent process.</p><p><strong>Mathematical specification</strong></p><p>If <span>$Z_t$</span> is a realisation of the latent model, then the unobserved/latent infections are given by</p><p class="math-container">\[I_t = g(\hat{I}_0 + Z_t).\]</p><p>where <span>$g$</span> is a transformation function and the unconstrained initial infections     <span>$\hat{I}_0$</span> are sampled from a prior distribution.</p><p><code>DirectInfections</code> are constructed by passing an <code>EpiData</code> object <code>data</code> and an <code>initialisation_prior</code> for the prior distribution of <span>$\hat{I}_0$</span>. The default <code>initialisation_prior</code> is <code>Normal()</code>.</p><p><strong>Constructors</strong></p><ul><li><code>DirectInfections(; data, initialisation_prior)</code></li></ul><p><strong>Example usage with <code>generate_latent_infs</code></strong></p><p><code>generate_latent_infs</code> can be used to construct a <code>Turing</code> model for the latent infections conditional on the sample path of a latent process. In this example, we generate a sample of a white noise latent process.</p><p>First, we construct a <code>DirectInfections</code> struct with an <code>EpiData</code> object, an initialisation prior and a transformation function.</p><pre><code class="language-julia hljs">using Distributions, Turing, EpiAware
gen_int = [0.2, 0.3, 0.5]
g = exp

# Create an EpiData object
data = EpiData(gen_int, g)

# Create a DirectInfections model
direct_inf_model = DirectInfections(data = data, initialisation_prior = Normal())</code></pre><p>Then, we can use <code>generate_latent_infs</code> to construct a Turing model for the unobserved infection generation model set by the type of <code>direct_inf_model</code>.</p><pre><code class="language-julia hljs"># Construct a Turing model
Z_t = randn(100)
latent_inf = generate_latent_infs(direct_inf_model, Z_t)</code></pre><p>Now we can use the <code>Turing</code> PPL API to sample underlying parameters and generate the unobserved infections.</p><pre><code class="language-julia hljs"># Sample from the unobserved infections model

#Sample random parameters from prior
θ = rand(latent_inf)
#Get unobserved infections as a generated quantities from the model
I_t = generated_quantities(latent_inf, θ)</code></pre><hr/><p><strong>Fields</strong></p><ul><li><p><code>data::EpiData</code>: <code>Epidata</code> object.</p></li><li><p><code>initialisation_prior::Distributions.Sampleable</code>: Prior distribution for the initialisation of the infections. Default is <code>Normal()</code>.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CDCgov/Rt-without-renewal/blob/94b46434c009860480828faa6a06b5e7fc4bafa1/src/EpiInfModels/DirectInfections.jl#L1">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EpiAware.EpiInfModels.EpiData" href="#EpiAware.EpiInfModels.EpiData"><code>EpiAware.EpiInfModels.EpiData</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct EpiData{T&lt;:Real, F&lt;:Function}</code></pre><p>The <code>EpiData</code> struct represents epidemiological data used in infectious disease modeling.</p><p><strong>Constructors</strong></p><ul><li><code>EpiData(gen_int, transformation::Function)</code>. Constructs an <code>EpiData</code> object with discrete</li></ul><p>generation interval <code>gen_int</code> and transformation function <code>transformation</code>.</p><ul><li><code>EpiData(;gen_distribution::ContinuousDistribution, D_gen, Δd = 1.0, transformation::Function = exp)</code>.</li></ul><p>Constructs an <code>EpiData</code> object with double interval censoring discretisation of the continuous next generation interval distribution <code>gen_distribution</code> with additional right truncation at <code>D_gen</code>. <code>Δd</code> sets the interval width (default = 1.0). <code>transformation</code> sets the transformation function</p><p><strong>Examples</strong></p><p>Construction direct from discrete generation interval and transformation function:</p><pre><code class="language-julia hljs">using EpiAware
gen_int = [0.2, 0.3, 0.5]
g = exp
data = EpiData(gen_int, g)</code></pre><p>Construction from continuous distribution for generation interval.</p><pre><code class="language-julia hljs">using Distributions

gen_distribution = Uniform(0.0, 10.0)

data = EpiData(;gen_distribution
    D_gen = 10.0)</code></pre><hr/><p><strong>Fields</strong></p><ul><li><p><code>gen_int::Vector{T} where T&lt;:Real</code>: Discrete generation interval.</p></li><li><p><code>len_gen_int::Integer</code>: Length of the discrete generation interval.</p></li><li><p><code>transformation::Function</code>: Transformation function defining constrained and unconstrained domain bijections.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CDCgov/Rt-without-renewal/blob/94b46434c009860480828faa6a06b5e7fc4bafa1/src/EpiInfModels/EpiData.jl#L1">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EpiAware.EpiInfModels.ExpGrowthRate" href="#EpiAware.EpiInfModels.ExpGrowthRate"><code>EpiAware.EpiInfModels.ExpGrowthRate</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct ExpGrowthRate{S&lt;:Distributions.Sampleable} &lt;: AbstractTuringEpiModel</code></pre><p>Model unobserved/latent infections as due to time-varying exponential growth rate <span>$r_t$</span> which is generated by a latent process.</p><p><strong>Mathematical specification</strong></p><p>If <span>$Z_t$</span> is a realisation of the latent model, then the unobserved/latent infections are given by</p><p class="math-container">\[I_t = g(\hat{I}_0) \exp(Z_t).\]</p><p>where <span>$g$</span> is a transformation function and the unconstrained initial infections     <span>$\hat{I}_0$</span> are sampled from a prior distribution.</p><p><code>ExpGrowthRate</code> are constructed by passing an <code>EpiData</code> object <code>data</code> and an <code>initialisation_prior</code> for the prior distribution of <span>$\hat{I}_0$</span>. The default <code>initialisation_prior</code> is <code>Normal()</code>.</p><p><strong>Constructor</strong></p><ul><li><code>ExpGrowthRate(; data, initialisation_prior)</code>.</li></ul><p><strong>Example usage with <code>generate_latent_infs</code></strong></p><p><code>generate_latent_infs</code> can be used to construct a <code>Turing</code> model for the latent infections conditional on the sample path of a latent process. In this example, we generate a sample of a white noise latent process.</p><p>First, we construct an <code>ExpGrowthRate</code> struct with an <code>EpiData</code> object, an initialisation prior and a transformation function.</p><pre><code class="language-julia hljs">using Distributions, Turing, EpiAware
gen_int = [0.2, 0.3, 0.5]
g = exp

# Create an EpiData object
data = EpiData(gen_int, g)

# Create an ExpGrowthRate model
exp_growth_model = ExpGrowthRate(data = data, initialisation_prior = Normal())</code></pre><p>Then, we can use <code>generate_latent_infs</code> to construct a Turing model for the unobserved infection generation model set by the type of <code>direct_inf_model</code>.</p><pre><code class="language-julia hljs"># Construct a Turing model
Z_t = randn(100) * 0.05
latent_inf = generate_latent_infs(exp_growth_model, Z_t)</code></pre><p>Now we can use the <code>Turing</code> PPL API to sample underlying parameters and generate the unobserved infections.</p><pre><code class="language-julia hljs"># Sample from the unobserved infections model

#Sample random parameters from prior
θ = rand(latent_inf)
#Get unobserved infections as a generated quantities from the model
I_t = generated_quantities(latent_inf, θ)</code></pre><hr/><p><strong>Fields</strong></p><ul><li><p><code>data::EpiData</code></p></li><li><p><code>initialisation_prior::Distributions.Sampleable</code></p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CDCgov/Rt-without-renewal/blob/94b46434c009860480828faa6a06b5e7fc4bafa1/src/EpiInfModels/ExpGrowthRate.jl#L1">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EpiAware.EpiInfModels.ODEProcess" href="#EpiAware.EpiInfModels.ODEProcess"><code>EpiAware.EpiInfModels.ODEProcess</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct ODEProcess{P&lt;:AbstractTuringLatentModel, S, F&lt;:Function, D&lt;:Union{Dict, NamedTuple}} &lt;: AbstractTuringEpiModel</code></pre><p>A structure representing an infection process modeled by an Ordinary Differential Equation (ODE). At a high level, an <code>ODEProcess</code> struct object combines:</p><ul><li>An <code>AbstractTuringParamModel</code> which defines the ODE model in terms of <code>OrdinaryDiffEq</code> types,    the parameters of the ODE model and a method to generate the parameters.</li><li>A technique for solving and interpreting the ODE model using the <code>SciML</code> ecosystem. This includes   the solver used in the ODE solution, keyword arguments to send to the solver and a function   to map the <code>ODESolution</code> solution object to latent infections.</li></ul><p><strong>Constructors</strong></p><ul><li><code>ODEProcess(prob::ODEProblem; ts, solver, sol2infs)</code>: Create an <code>ODEProcess</code></li></ul><p>object with the ODE problem <code>prob</code>, time points <code>ts</code>, solver <code>solver</code>, and function <code>sol2infs</code>.</p><p><strong>Predefined ODE models</strong></p><p>Two basic ODE models are provided in the <code>EpiAware</code> package: <code>SIRParams</code> and <code>SEIRParams</code>. In both cases these are defined in terms of the proportions of the population in each compartment of the SIR and SEIR models respectively.</p><p><strong>SIR model</strong></p><p class="math-container">\[\begin{aligned}
\frac{dS}{dt} &amp;= -\beta SI \\
\frac{dI}{dt} &amp;= \beta SI - \gamma I \\
\frac{dR}{dt} &amp;= \gamma I
\end{aligned}\]</p><p>Where <code>S</code> is the proportion of the population that is susceptible, <code>I</code> is the proportion of the population that is infected and <code>R</code> is the proportion of the population that is recovered. The parameters are the infectiousness <code>β</code> and the recovery rate <code>γ</code>.</p><pre><code class="language-julia hljs">using EpiAware, OrdinaryDiffEq, Distributions

# Create an instance of SIRParams
sirparams = SIRParams(
    tspan = (0.0, 100.0),
    infectiousness = LogNormal(log(0.3), 0.05),
    recovery_rate = LogNormal(log(0.1), 0.05),
    initial_prop_infected = Beta(1, 99)
)
nothing</code></pre><p><strong>SEIR model</strong></p><p class="math-container">\[\begin{aligned}
\frac{dS}{dt} &amp;= -\beta SI \\
\frac{dE}{dt} &amp;= \beta SI - \alpha E \\
\frac{dI}{dt} &amp;= \alpha E - \gamma I \\
\frac{dR}{dt} &amp;= \gamma I
\end{aligned}\]</p><p>Where <code>S</code> is the proportion of the population that is susceptible, <code>E</code> is the proportion of the population that is exposed, <code>I</code> is the proportion of the population that is infected and <code>R</code> is the proportion of the population that is recovered. The parameters are the infectiousness <code>β</code>, the incubation rate <code>α</code> and the recovery rate <code>γ</code>.</p><pre><code class="language-julia hljs">using EpiAware, OrdinaryDiffEq, Distributions, Random
Random.seed!(1234)

# Create an instance of SIRParams
seirparams = SEIRParams(
    tspan = (0.0, 100.0),
    infectiousness = LogNormal(log(0.3), 0.05),
    incubation_rate = LogNormal(log(0.1), 0.05),
    recovery_rate = LogNormal(log(0.1), 0.05),
    initial_prop_infected = Beta(1, 99)
)
nothing</code></pre><p><strong>Usage example with <code>ODEProcess</code> and predefined SIR model</strong></p><p>In this example we define an <code>ODEProcess</code> object using the predefined <code>SIRParams</code> model from above. We then generate latent infections using the <code>generate_latent_infs</code> function, and refit the model using a <code>Turing</code> model.</p><p>We assume that the latent infections are observed with a Poisson likelihood around their ODE model prediction. The population size is <code>N = 1000</code>, which we put into the <code>sol2infs</code> function, which maps the ODE solution to the number of infections. Recall that the <code>EpiAware</code> default SIR implementation assumes the model is in density/proportion form. Also, note that since the <code>sol2infs</code> function is a link function that maps the ODE solution to the expected number of infections we also apply the <code>LogExpFunctions.softplus</code> function to ensure that the expected number of infections is non-negative. Note that the <code>softplus</code> function is a smooth approximation to the ReLU function <code>x -&gt; max(0, x)</code>. The utility of this approach is that small negative output from the ODE solver (e.g. ~ -1e-10) will be mapped to small positive values, without needing to use strict positivity constraints in the model.</p><p>First, we define the <code>ODEProcess</code> object which combines the SIR model with the <code>sol2infs</code> link function and the solver options.</p><pre><code class="language-julia hljs">using Turing, LogExpFunctions
N = 1000.0

sir_process = ODEProcess(
    params = sirparams,
    sol2infs = sol -&gt; softplus.(N .* sol[2, :]),
    solver_options = Dict(:verbose =&gt; false, :saveat =&gt; 1.0)
)
nothing</code></pre><p>Second, we define a <code>PoissionError</code> observation model for linking the  the number of infections.</p><pre><code class="language-julia hljs">pois_obs = PoissonError()
nothing</code></pre><p>Next, we create a <code>Turing</code> model for the full generative process: this solves the ODE model for the latent infections and then samples the observed infections from a Poisson distribution with this as the average.</p><p>NB: The <code>nothing</code> argument is a dummy latent process, e.g. a log-Rt time series, that is not used in the SIR model, but might be used in other models.</p><pre><code class="language-julia hljs">@model function fit_ode_model(data)
    @submodel I_t = generate_latent_infs(sir_process, nothing)
    @submodel y_t = generate_observations(pois_obs, data, I_t)

    return y_t
end
nothing</code></pre><p>We can generate some test data from the model by passing <code>missing</code> as the argument to the model. This tells <code>Turing</code> that there is no data to condition on, so it will sample from the prior parameters and then generate infections. In this case, we do it in a way where we cache the sampled parameters as <code>θ</code> for later use.</p><pre><code class="language-julia hljs"># Sampled parameters
gen_mdl = fit_ode_model(missing)
θ = rand(gen_mdl)
test_data = (gen_mdl | θ)()
nothing</code></pre><p>Now, we can refit the model but this time we condition on the test data. We suppress the output of the sampling process to keep the output clean, but you can remove the <code>@suppress</code> macro.</p><pre><code class="language-julia hljs">using Suppressor
inference_mdl = fit_ode_model(test_data)
chn = Suppressor.@suppress sample(inference_mdl, NUTS(), 2_000)
summarize(chn)
nothing</code></pre><p>We can compare the summarized chain to the sampled parameters in <code>θ</code> to see that the model is fitting the data well and recovering a credible interval containing the true parameters.</p><p><strong>Custom ODE models</strong></p><p>To define a custom ODE model, you need to define:</p><ul><li>Some <code>CustomModel &lt;: AbstractTuringLatentModel</code> struct   that contains the ODE problem as a field called <code>prob</code>, as well as sufficient fields to   define or sample the parameters of the ODE model.</li><li>A method for <code>EpiAwareBase.generate_latent(params::CustomModel, Z_t)</code> that generates the   initial condition and parameters of the ODE model, potentially conditional on a sample from a latent process <code>Z_t</code>.   This method must return a <code>Tuple</code> <code>(u0, p)</code> where <code>u0</code> is the initial condition and <code>p</code> is the parameters.</li></ul><p>Here is an example of a simple custom ODE model for <em>specified</em> exponential growth:</p><pre><code class="language-julia hljs">using EpiAware, Turing, OrdinaryDiffEq
# Define a simple exponential growth model for testing
function expgrowth(du, u, p, t)
    du[1] = p[1] * u[1]
end

r = log(2) / 7 # Growth rate corresponding to 7 day doubling time

# Define the ODE problem using SciML
prob = ODEProblem(expgrowth, [1.0], (0.0, 10.0), [r])

# Define the custom parameters struct
struct CustomModel &lt;: AbstractTuringLatentModel
    prob::ODEProblem
    r::Float64
    u0::Float64
end
custom_ode = CustomModel(prob, r, 1.0)

# Define the custom generate_latent function
@model function EpiAwareBase.generate_latent(params::CustomModel, n)
    return ([params.u0], [params.r])
end
nothing</code></pre><p>This model is not random! But we can still use it to generate latent infections.</p><pre><code class="language-julia hljs"># Define the ODEProcess
expgrowth_model = ODEProcess(
    params = custom_ode,
    sol2infs = sol -&gt; sol[1, :]
)
infs = generate_latent_infs(expgrowth_model, nothing)()
nothing</code></pre><hr/><p><strong>Fields</strong></p><ul><li><p><code>params::AbstractTuringLatentModel</code>: The ODE problem and parameters, where <code>P</code> is a subtype of <code>AbstractTuringLatentModel</code>.</p></li><li><p><code>solver::Any</code>: The solver used for the ODE problem. Default is <code>AutoVern7(Rodas5())</code>, which is an auto     switching solver aimed at medium/low tolerances.</p></li><li><p><code>sol2infs::Function</code>: A function that maps the solution object of the ODE to infection counts.</p></li><li><p><code>solver_options::Union{Dict, NamedTuple}</code>: The extra solver options for the ODE problem. Can be either a <code>Dict</code> or a <code>NamedTuple</code>     containing the solver options.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CDCgov/Rt-without-renewal/blob/94b46434c009860480828faa6a06b5e7fc4bafa1/src/EpiInfModels/ODEProcess.jl#L1">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EpiAware.EpiInfModels.Renewal" href="#EpiAware.EpiInfModels.Renewal"><code>EpiAware.EpiInfModels.Renewal</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct Renewal{E, S&lt;:Distributions.Sampleable, A} &lt;: AbstractTuringRenewal</code></pre><p>Model unobserved/latent infections as due to time-varying Renewal model with reproduction number <span>$\mathcal{R}_t$</span> which is generated by a latent process.</p><p><strong>Mathematical specification</strong></p><p>If <span>$Z_t$</span> is a realisation of the latent model, then the unobserved/latent infections are given by</p><p class="math-container">\[\begin{align}
\mathcal{R}_t &amp;= g(Z_t),\\
I_t &amp;= \mathcal{R}_t \sum_{i=1}^{n-1} I_{t-i} g_i, \qquad t \geq 1, \\
I_t &amp;= g(\hat{I}_0) \exp(r(\mathcal{R}_1) t), \qquad t \leq 0.
\end{align}\]</p><p>where <span>$g$</span> is a transformation function and the unconstrained initial infections <span>$\hat{I}_0$</span> are sampled from a prior distribution. The discrete generation interval is given by <span>$g_i$</span>.</p><p><span>$r(\mathcal{R}_1)$</span> is the exponential growth rate implied by <span>$\mathcal{R}_1)$</span> using the implicit relationship between the exponential growth rate and the reproduction number.</p><p class="math-container">\[\mathcal{R} \sum_{j \geq 1} g_j \exp(- r j)= 1.\]</p><p><code>Renewal</code> are constructed by passing an <code>EpiData</code> object <code>data</code> and an <code>initialisation_prior</code> for the prior distribution of <span>$\hat{I}_0$</span>. The default <code>initialisation_prior</code> is <code>Normal()</code>.</p><p><strong>Constructors</strong></p><ul><li><code>Renewal(; data, initialisation_prior)</code>. Construct a <code>Renewal</code> model with default update steps.</li><li><code>Renewal(data; initialisation_prior)</code>. Construct a <code>Renewal</code> model with default update steps.</li><li><code>Renewal(data, initialisation_prior, recurrent_step)</code> Construct a <code>Renewal</code> model with <code>recurrent_step</code> update step function.</li></ul><p><strong>Example usage with <code>generate_latent_infs</code></strong></p><p><code>generate_latent_infs</code> can be used to construct a <code>Turing</code> model for the latent infections conditional on the sample path of a latent process. In this example, we generate a sample of a white noise latent process.</p><p>First, we construct an <code>Renewal</code> struct with an <code>EpiData</code> object, an initialisation prior and a transformation function.</p><pre><code class="language-julia hljs">using Distributions, Turing, EpiAware
gen_int = [0.2, 0.3, 0.5]
g = exp

# Create an EpiData object
data = EpiData(gen_int, g)

# Create an Renewal model
renewal_model = Renewal(data; initialisation_prior = Normal())</code></pre><p>Then, we can use <code>generate_latent_infs</code> to construct a Turing model for the unobserved infection generation model set by the type of <code>direct_inf_model</code>.</p><pre><code class="language-julia hljs"># Construct a Turing model
Z_t = randn(100) * 0.05
latent_inf = generate_latent_infs(renewal_model, Z_t)</code></pre><p>Now we can use the <code>Turing</code> PPL API to sample underlying parameters and generate the unobserved infections.</p><pre><code class="language-julia hljs"># Sample from the unobserved infections model

#Sample random parameters from prior
θ = rand(latent_inf)
#Get unobserved infections as a generated quantities from the model
I_t = generated_quantities(latent_inf, θ)</code></pre><hr/><p><strong>Fields</strong></p><ul><li><p><code>data::Any</code></p></li><li><p><code>initialisation_prior::Distributions.Sampleable</code></p></li><li><p><code>recurrent_step::Any</code></p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CDCgov/Rt-without-renewal/blob/94b46434c009860480828faa6a06b5e7fc4bafa1/src/EpiInfModels/Renewal.jl#L1">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EpiAware.EpiInfModels.R_to_r-Union{Tuple{T}, Tuple{Any, Vector{T}}} where T&lt;:AbstractFloat" href="#EpiAware.EpiInfModels.R_to_r-Union{Tuple{T}, Tuple{Any, Vector{T}}} where T&lt;:AbstractFloat"><code>EpiAware.EpiInfModels.R_to_r</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">R_to_r(
    R₀,
    w::Array{T&lt;:AbstractFloat, 1};
    newton_steps,
    Δd
) -&gt; Any
</code></pre><p>This function computes an approximation to the exponential growth rate <code>r</code> given the reproductive ratio <code>R₀</code> and the discretized generation interval <code>w</code> with discretized interval width <code>Δd</code>. This is based on the implicit solution of</p><p class="math-container">\[G(r) - {1 \over R_0} = 0.\]</p><p>where</p><p class="math-container">\[G(r) = \sum_{i=1}^n w_i e^{-r i}.\]</p><p>is the negative moment generating function (MGF) of the generation interval distribution.</p><p>The two step approximation is based on:     1. Direct solution of implicit equation for a small <code>r</code> approximation.     2. Improving the approximation using Newton&#39;s method for a fixed number of steps <code>newton_steps</code>.</p><p>Returns:</p><ul><li>The approximate value of <code>r</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CDCgov/Rt-without-renewal/blob/94b46434c009860480828faa6a06b5e7fc4bafa1/src/EpiInfModels/utils.jl#L20">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EpiAware.EpiInfModels.expected_Rt-Tuple{EpiData, Vector{&lt;:Real}}" href="#EpiAware.EpiInfModels.expected_Rt-Tuple{EpiData, Vector{&lt;:Real}}"><code>EpiAware.EpiInfModels.expected_Rt</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">expected_Rt(
    data::EpiData,
    infections::Vector{&lt;:Real}
) -&gt; Any
</code></pre><p>Calculate the expected Rt values based on the given <code>EpiData</code> object and infections.</p><p class="math-container">\[R_t = \frac{I_t}{\sum_{i=1}^{n} I_{t-i} g_i}\]</p><p><strong>Arguments</strong></p><ul><li><code>data::EpiData</code>: An instance of the EpiData type containing generation interval data.</li><li><code>infections::Vector{&lt;:Real}</code>: A vector of infection data.</li></ul><p><strong>Returns</strong></p><ul><li><code>exp_Rt::Vector{Float64}</code>: A vector of expected Rt values.</li></ul><p><strong>Examples</strong></p><pre><code class="language-julia hljs">using EpiAware

data = EpiData([0.2, 0.3, 0.5], exp)
infections = [100, 200, 300, 400, 500]
expected_Rt(data, infections)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CDCgov/Rt-without-renewal/blob/94b46434c009860480828faa6a06b5e7fc4bafa1/src/EpiInfModels/EpiData.jl#L65">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EpiAware.EpiInfModels.r_to_R-Tuple{Any, AbstractVector}" href="#EpiAware.EpiInfModels.r_to_R-Tuple{Any, AbstractVector}"><code>EpiAware.EpiInfModels.r_to_R</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">r_to_R(r, w::AbstractVector) -&gt; Any
</code></pre><pre><code class="nohighlight hljs">r_to_R(r, w)</code></pre><p>Compute the reproductive ratio given exponential growth rate <code>r</code>     and discretized generation interval <code>w</code>.</p><p><strong>Arguments</strong></p><ul><li><code>r</code>: The exponential growth rate.</li><li><code>w</code>: discretized generation interval.</li></ul><p><strong>Returns</strong></p><ul><li>The reproductive ratio.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CDCgov/Rt-without-renewal/blob/94b46434c009860480828faa6a06b5e7fc4bafa1/src/EpiInfModels/utils.jl#L59">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Overview</a><a class="docs-footer-nextpage" href="../internals/">Internal API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Monday 6 January 2025 10:39">Monday 6 January 2025</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
